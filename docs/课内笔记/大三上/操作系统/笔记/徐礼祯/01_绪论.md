# 1 绪论

## 1.1 什么是操作系统?

- 操作系统是**用以控制和管理计算机系统资源，方便用户使用的程序和数据结构的集合**；
- 操作系统是**管理计算机硬件的程序**；
- 操作系统是**在计算机用户和计算机硬件之间起媒介作用的一种程序**。

操作系统也有其他定义，如：

- Resource allocator 系统资源分配者
- Control program 控制程序
- Kernel 内核——在全时运行的一个程序（其他的是应用）

---------------------------------------------------------------------------------------

## 1.2 OS的发展与类型

### 1.2.1 手工操作

- 1946～1950（真空管）
- 集中计算
- 用户独占全机，独占系统的全部硬件资源，设备利用率很低
- 无操作系统

### 1.2.2 单道批处理系统（Simple Batch Processing）

- 50～60年代
- 把一批作业以**脱机输入**方式输入到磁带/磁鼓
- 批处理系统解决了告诉计算机的运算、处理能力与人工干预之间的速度矛盾，实现了作业自动过渡。

**运行特征**：

- **顺序性**：磁带上的各道作业顺序进入内存，各作业的完成顺序与他们进入内存的顺序相同；
- **单道性**：内存中仅有一道程序运行
- **自动性**

**优点**  
减少了CPU的空闲时间，提高了主机CPU和I/O设备的使用效率，提高了吞吐量

**缺点**  
**CPU和I/O设备使用忙闲不均**

脱机I/O方式：  
I/O工作在外围机/卫星机的控制下完成，或者说是**在脱离主机的情况下进行**。使用磁带作为输入/输出的中介，这种具体的输入/输出不需要在主计算机上进行的方式称为"脱机输入/输出"。

### 1.2.3 多道程序批处理系统（Multiprogrammed Batch Systems）

**多道**：内存中同时存放几个作业，使之都处于执行的开始点和结束点之间，多个作业共享CPU、内存、外设等资源

**目的**：利用多道批处理提高资源的利用率

**60年代通道和终端技术的出现解决了输入输出等待计算的问题**

- **通道**：一种专用部件，负责外部设备与内存之间的传输
- **中断**：指主机接到外界的信号（来自CPU外部或内部）时，立即中止原来的工作，转去处理这一外来事件，处理完后又回到原来工作点继续工作。

多道通过组织作业使得CPU总在执行其中一个作业，从而提高了效率。

多道程序对OS要求：

- **存储管理**（Memory Management）：系统必须为若干作业分派空间；
- **CPU调度**（CPU Scheduling）：系统必须在就绪作业中挑选
- **设备分配**（Allocation of Devices）
- **系统提供I/O程序**(I/O Routine Supplied by the System)

多道批处理系统所用技术：

- **作业调度**：作业的现场保存和回复——上下文切换；
- **资源共享**：资源的竞争和同步——互斥（exclusion）和同步（synchronization）机制；
- **内存使用**：提高内存使用效率——覆盖（overlap），交换（swap）和虚拟存储（virtual memory）；
- **内存保护**：系统存储区和各应用程序存储区不可冲突；
- 文件顺序存放、随机存取。

多道批处理系统的运行特征：

- **多道性**：内存中同时驻留多道程序并发执行，从而有效地提高了资源利用率和系统吞吐量；
- **无序性**：作业的完成顺序与它进入内存的顺序之间无严格的对应关系；
- **调度性**：作业调度、进程调度。

**优点**：

- 资源利用率高：CPU，内存，I/O设备
- 系统吞吐量大

**缺点**：

- 无交互能力，用户响应时间长
- 作业平均周转时间长

### 1.2.4分时系统（Time-Sharing System）

- 70年代中期至今

- **分时**是指多个用户分享使用同一台计算机，多个程序分时共享硬件和软件资源

- 实现方式：
  
  - 多个用户分时
  - 前台和后台程序分时(foreground & background)分时：后台程序不占用终端输入输出，不与用户交互

- 把CPU的时间分成若干个大小相等或不等的时间单位，称为**时间片**（Time Slice），每个终端用户获得CPU后开始运行，当时间片结束，该用户程序暂停运行，等待下一次运行。

- 特点：
  
  - **多路性**：众多联机用户可以同时使用同一台计算机；
  - **独占性**：各终端用户感觉到自己独占了计算机；
  - **交互性**：用户与计算机之间可进行“会话”；
  - **及时性**：用户的请求能在很短的时间内获得相应。

在分时操作系统的基础上，操作系统开始发展分化：

#### (1) **实时操作系统**（Real-Time Systems）

严格确定的时间限制

- 硬实时系统（Hard Real-Time Systems）
  - 有限的或没有次级存储器，数据存在短期存储器或只读存储器（Read-Only Memory, ROM）中；
  - 同分时系统冲突，不支持通用操作系统；
- 软实时系统（Soft Real-Time Systems）

特征：

1. 实时时钟管理：提供系统日期和时间、定时和延时等时钟管理功能；
2. 过载保护：缓冲区排队，丢弃某些任务，动态调整任务周期；过载是指进入系统的任务数目超出系统的处理能力；
3. 高度可靠性和安全性——容错能力（如故障自动复位）和冗余备份。

实时操作系统与批处理系统和分时系统的区别

1. **专用系统**：许多实时系统是专用系统，而批处理与分时系统通常是通用系统；
2. **实时控制**：实时系统用户控制实时过程，要求对外部时间的迅速相应，具有较强的中断处理机构；
3. **高可靠性**：实时操作系统用于控制重要过程，要求高可靠度，具有较高冗余，如双机系统；
4. **事件驱动和队列驱动**：实时系统的工作方式是接受外部消息$\rightarrow$分析消息$\rightarrow$调用相应处理程序进行处理
5. **可与通用系统结合成通用实时系统**：实时处理前台作业，批处理后台作业。

#### (2) 并行系统（Parallel Systems）

​    也称多处理器系统（Multi-Processor Systems），是由紧密通信的、多于一个CPU的多处理器系统。

​    是紧耦合（Tightly Coupled System），处理器共享内存和时钟；一般通过共享内存进行通信

并行系统的优点：

1. 增大吞吐量（Throughput）；
2. 经济
3. 提高可靠性

##### 对称多处理器（Symmetric Multiprocessing, SMP）

- 每个处理器运行操作系统的相同副本；
- 许多进程可以立即运行不会降低性能。

##### 非对称多处理器（Asymmetric Multiprocessing, AMP）

- 每个处理器赋予一个特定任务，主处理器为从处理器调度和分配作业；
- 常用在非常大的系统中。

#### (3) 分布式系统（Distributed Systems）

计算分布在若干物理处理器上，是一种**松散耦合系统**（Loosely Coupled System）。每一个处理器有自身的本地存储器，通过各种通信设施（如高速总线）进行处理器之间的通信。

分布式系统具有一个统一的操作系统，它可以把一个大任务划分成很多可以并行执行的子任务，并按一定的策略将它们动态地分配给各个计算机执行，并控制管理各个计算机的资源分配、运行及计算机之间的通信，以协调任务的并行执行。

以上所有的管理工作对用户都是透明的。

**分布式操作系统的优点**

- 资源共享（Resources Sharing）
- 加快计算-共享装载（Computation Speed Up - Load Sharing）
- 可靠（Reliability）
- 通信（Communications）

#### (4) 网络操作系统（Network Operation System, NOS）

​        网络操作系统是在通常操作系统功能的基础上**提供网络通信和网络服务功能**的操作系统。网络操作系统为网上计算机进行方便而有效的网络资源共享，提供网络用户所需要的各种软件的相关规程的集合。

网络操作系统的功能：

1. **通常操作系统的功能**：处理机管理、存储器管理、设备管理、文件管理等；
2. **网络通信功能**：通过网络协议进行高效、可靠的数据传输；
3. **资源管理**：协调各用户使用；
4. **网络服务**：文件和设备共享，信息发布；
5. **网络管理**：安全管理、故障管理、性能管理等；
6. **互操作**：直接控制对方比交换数据更为困难；

#### (4) 嵌入式操作系统（Embedded Operating System）

​        **嵌入式系统**是在各种设备、装置或系统中，完成特定功能的软硬件系统。它是一个大设备、装备或系统中的一部分，这个大设备、装置或系统可以不是“计算机”。

​        在嵌入式系统中的OS，被称为**嵌入式操作系统**。嵌入式操作系统是运行在嵌入式只能芯片环境中对整个只能芯片及它所操作、控制的各种部件装置等资源进行同一协调调度、指挥和控制的系统软件。

#### (5) 个人计算机系统（Personal-Computer System）

供个人使用的计算机系统。

---------------------------------------------------------------------------------------

## 1.3 Functions of OS

### 1.3.1 处理机管理

目标：完成处理机资源分配和调度等功能。

功能：

- **进程控制**：创建、撤销、挂起、改变运行优先级等（主动改变进程状态）；
- **进程调度**：作业和进程的运行转换，以充分利用处理机资源和提高系统性能；
- **进程同步**：协调并发进程之间的推进步骤，以协调资源共享；
- **进程通信**：进程之间的信息交换。

### 1.3.2 存储管理

存储管理的任务是对要运行的作业分配内存空间，作业运行时要收回其所占用的内存空间。操作系统要对每一个作业的内存空间和系统内存空间实施保护。

目标：提供哦啊内存利用率、方便用户使用、提供足够的存储空间。

功能

- 存储分配与回收；
- 存储保护；
- 地址重定位；
- 内存扩充。

### 1.3.3 设备管理

目标：完成用户的I/O请求,为用户分配I/O设备、提高I/O速度，提高CPU与I/O设备利用率、方便设备使用

功能

- 缓冲管理
- 设备分配与回收
- 设备处理：利用设备驱动程序（通常在内核中）完成对设备的操作。
- 虚拟设备
- 设备独立性：提供统一的I/O设备接口，使应用程序独立于物理设备

### 1.3.4 文件管理

目标：实现外存上的信息资源“按名存取” 

功能

- **文件存储空间管理**：如何存放信息，以提高空间利用率
- **目录管理**：文件检索
- **文件存取控制**：文件保护
- **软件管理**：软件的版本、相互依赖关系、安装和拆除等

### 1.3.5 用户接口

目标：为用户使用计算机系统提供一个友好的访问OS的接口

操作系统提供2类接口：

- **作业级接口**：命令行、菜单、或图形化的操作界面（GUI）、语音以及作业控制语言等；“联机”或“脱机”。
- **程序级接口**：供用户程序和系统程序调用操作系统功能，也称系统调用；

---------------------------------------------------------------------------------------

## 1.4 现代操作系统的特征 Features of OS

### 1.4.1 并发（Concurrency）

多个事件在同一时间段内发生。操作系统是一个并发系统，各进程间的并发，系统与应用间的并发。操作系统要完成这些并发过程的管理。并行(parallel)是指在同一时刻发生。

在多道程序处理时，宏观上并发，微观上交替执行（在单处理器情况下）。

程序的静态实体是可执行文件，而动态实体是进程（或称作任务），并发指的是进程

### 1.4.2 共享（Sharing）

多个进程共享有限的计算机系统资源。操作系统要对系统资源进行合理分配和使用。资源在一个时间段内交替被多个进程所用。

互斥共享（如音频设备）：资源分配后到释放前，不能被其他进程所用。

同时访问（如可重入代码，磁盘文件）

资源分配难以达到最优化

### 1.4.3 虚拟（Virtual）

一个物理实体映射为若干个对应的逻辑实体－－分时或分空间。虚拟是操作系统管理系统资源的重要手段，可提高资源利用率。
CPU－－每个用户（进程）的“虚处理机”
存储器－－每个进程都占有的地址空间（指令＋数据＋堆栈）
显示设备－－多窗口或虚拟终端(virtual terminal)

### 1.4.4 异步性(asynchronism)

也称**不确定性**，指进程的执行顺序和执行时间的不确定性；
进程的运行速度不可预知：分时系统中，多个进程并发执行，“时走时停”，不可预知每个进程的运行推进快慢
判据：无论快慢，应该结果相同－－通过进程互斥和同步手段来保证
难以重现系统在某个时刻的状态（包括重现运行中的错误）
